/*
 * PhoneGap is available under *either* the terms of the modified BSD license *or* the
 * MIT License (2008). See http://opensource.org/licenses/alphabetical for full text.
 * 
 * Copyright (c) 2005-2010, Nitobi Software Inc.
 * Copyright (c) 2010, IBM Corporation
 */
PhoneGap={};PhoneGap.Channel=function(type){this.type=type;this.handlers={};this.guid=0;this.fired=false;this.enabled=true};PhoneGap.Channel.prototype.subscribe=function(f,c,g){if(f==null){return}var func=f;if(typeof c=="object"&&f instanceof Function){func=PhoneGap.close(c,f)}g=g||func.observer_guid||f.observer_guid||this.guid++;func.observer_guid=g;f.observer_guid=g;this.handlers[g]=func;return g};PhoneGap.Channel.prototype.subscribeOnce=function(f,c){var g=null;var _this=this;var m=function(){f.apply(c||null,arguments);_this.unsubscribe(g)};if(this.fired){if(typeof c=="object"&&f instanceof Function){f=PhoneGap.close(c,f)}f.apply(this,this.fireArgs)}else{g=this.subscribe(m)}return g};PhoneGap.Channel.prototype.unsubscribe=function(g){if(g instanceof Function){g=g.observer_guid}this.handlers[g]=null;delete this.handlers[g]};PhoneGap.Channel.prototype.fire=function(e){if(this.enabled){var fail=false;for(var item in this.handlers){var handler=this.handlers[item];if(handler instanceof Function){var rv=(handler.apply(this,arguments)==false);fail=fail||rv}}this.fired=true;this.fireArgs=arguments;return !fail}return true};PhoneGap.Channel.join=function(h,c){var i=c.length;var f=function(){if(!(--i)){h()}};for(var j=0;j<i;j++){(!c[j].fired?c[j].subscribeOnce(f):i--)}if(!i){h()}};PhoneGap.addConstructor=function(func){PhoneGap.onPhoneGapInit.subscribeOnce(function(){try{func()}catch(e){if(typeof(debug.log)=="function"){debug.log("Failed to run constructor: "+debug.processMessage(e))}else{alert("Failed to run constructor: "+e.message)}}})};if(!window.plugins){window.plugins={}}PhoneGap.addPlugin=function(name,obj){if(!window.plugins[name]){window.plugins[name]=obj}else{console.log("Plugin "+name+" already exists.")}};PhoneGap.onDOMContentLoaded=new PhoneGap.Channel("onDOMContentLoaded");PhoneGap.onNativeReady=new PhoneGap.Channel("onNativeReady");PhoneGap.onPhoneGapInit=new PhoneGap.Channel("onPhoneGapInit");PhoneGap.onPhoneGapReady=new PhoneGap.Channel("onPhoneGapReady");PhoneGap.onPhoneGapInfoReady=new PhoneGap.Channel("onPhoneGapInfoReady");PhoneGap.onResume=new PhoneGap.Channel("onResume");PhoneGap.onPause=new PhoneGap.Channel("onPause");blackberry.app.event.onForeground(function(){PhoneGap.onResume.fire()});blackberry.app.event.onBackground(function(){PhoneGap.onPause.fire()});blackberry.app.event.onExit(function(){PhoneGap.onPause.fire();phonegap.PluginManager.destroy();blackberry.app.exit()});if(typeof _nativeReady!=="undefined"){PhoneGap.onNativeReady.fire()}PhoneGap.onDeviceReady=new PhoneGap.Channel("onDeviceReady");PhoneGap.Channel.join(function(){PhoneGap.onPhoneGapInit.fire();PhoneGap.onPhoneGapReady.fire()},[PhoneGap.onDOMContentLoaded,PhoneGap.onNativeReady]);PhoneGap.Channel.join(function(){PhoneGap.onDeviceReady.fire();PhoneGap.onResume.fire()},[PhoneGap.onPhoneGapReady,PhoneGap.onPhoneGapInfoReady]);document.addEventListener("DOMContentLoaded",function(){PhoneGap.onDOMContentLoaded.fire()},false);PhoneGap.m_document_addEventListener=document.addEventListener;document.addEventListener=function(evt,handler,capture){var e=evt.toLowerCase();if(e=="deviceready"){PhoneGap.onDeviceReady.subscribeOnce(handler)}else{if(e=="resume"){PhoneGap.onResume.subscribe(handler);if(PhoneGap.onResume.fired&&handler instanceof Function){handler()}}else{if(e=="pause"){PhoneGap.onPause.subscribe(handler)}else{PhoneGap.m_document_addEventListener.call(document,evt,handler,capture)}}}};PhoneGap.m_element_addEventListener=Element.prototype.addEventListener;Element.prototype.addEventListener=function(evt,handler,capture){if(evt==="touchstart"){evt="click"}PhoneGap.m_element_addEventListener.call(this,evt,handler,capture)};PhoneGap.clone=function(obj){if(!obj){return obj}if(obj instanceof Array){var retVal=new Array();for(var i=0;i<obj.length;++i){retVal.push(PhoneGap.clone(obj[i]))}return retVal}if(obj instanceof Function){return obj}if(!(obj instanceof Object)){return obj}if(obj instanceof Date){return obj}retVal=new Object();for(i in obj){if(!(i in retVal)||retVal[i]!=obj[i]){retVal[i]=PhoneGap.clone(obj[i])}}return retVal};PhoneGap.close=function(context,func,params){if(typeof params==="undefined"){return function(){return func.apply(context,arguments)}}else{return function(){return func.apply(context,params)}}};PhoneGap.callbackId=0;PhoneGap.callbacks={};PhoneGap.callbackStatus={NO_RESULT:0,OK:1,CLASS_NOT_FOUND_EXCEPTION:2,ILLEGAL_ACCESS_EXCEPTION:3,INSTANTIATION_EXCEPTION:4,MALFORMED_URL_EXCEPTION:5,IO_EXCEPTION:6,INVALID_ACTION:7,JSON_EXCEPTION:8,ERROR:9};PhoneGap.callbackSuccess=function(callbackId,args){if(PhoneGap.callbacks[callbackId]){if(args.status==PhoneGap.callbackStatus.OK){try{if(PhoneGap.callbacks[callbackId].success){PhoneGap.callbacks[callbackId].success(args.message)}}catch(e){console.log("Error in success callback: "+callbackId+" = "+e)}}if(!args.keepCallback){delete PhoneGap.callbacks[callbackId]}}};PhoneGap.callbackError=function(callbackId,args){if(PhoneGap.callbacks[callbackId]){try{if(PhoneGap.callbacks[callbackId].fail){PhoneGap.callbacks[callbackId].fail(args.message)}}catch(e){console.log("Error in error callback: "+callbackId+" = "+e)}if(!args.keepCallback){delete PhoneGap.callbacks[callbackId]}}};PhoneGap.exec=function(success,fail,service,action,args){try{var callbackId=service+PhoneGap.callbackId++;if(success||fail){PhoneGap.callbacks[callbackId]={success:success,fail:fail}}var r=""+phonegap.PluginManager.exec(service,action,callbackId,JSON.stringify(args),true);if(r.length>0){eval("var v="+r+";");if(v.status==PhoneGap.callbackStatus.OK){if(success){try{success(v.message)}catch(e){console.log("Error in success callback: "+callbackId+" = "+e)}if(!v.keepCallback){delete PhoneGap.callbacks[callbackId]}}return v.message}else{if(v.status==PhoneGap.callbackStatus.NO_RESULT){if(!v.keepCallback){delete PhoneGap.callbacks[callbackId]}}else{console.log("Error: Status="+r.status+" Message="+v.message);if(fail){try{fail(v.message)}catch(e){console.log("Error in error callback: "+callbackId+" = "+e)}if(!v.keepCallback){delete PhoneGap.callbacks[callbackId]}}return null}}}}catch(e){console.log("Error: "+e)}};PhoneGap.createUUID=function(){return PhoneGap.UUIDcreatePart(4)+"-"+PhoneGap.UUIDcreatePart(2)+"-"+PhoneGap.UUIDcreatePart(2)+"-"+PhoneGap.UUIDcreatePart(2)+"-"+PhoneGap.UUIDcreatePart(6)};PhoneGap.UUIDcreatePart=function(length){var uuidpart="";for(var i=0;i<length;i++){var uuidchar=parseInt((Math.random()*256)).toString(16);if(uuidchar.length==1){uuidchar="0"+uuidchar}uuidpart+=uuidchar}return uuidpart};function Acceleration(x,y,z){this.x=x;this.y=y;this.z=z;this.timestamp=new Date().getTime()}function Accelerometer(){this.lastAcceleration=null;this.timers={}}Accelerometer.prototype.getCurrentAcceleration=function(successCallback,errorCallback,options){if(typeof successCallback!="function"){console.log("Accelerometer Error: successCallback is not a function");return}if(errorCallback&&(typeof errorCallback!="function")){console.log("Accelerometer Error: errorCallback is not a function");return}PhoneGap.exec(successCallback,errorCallback,"Accelerometer","getAcceleration",[])};Accelerometer.prototype.watchAcceleration=function(successCallback,errorCallback,options){var frequency=(options!=undefined)?options.frequency:10000;if(typeof successCallback!="function"){console.log("Accelerometer Error: successCallback is not a function");return}if(errorCallback&&(typeof errorCallback!="function")){console.log("Accelerometer Error: errorCallback is not a function");return}PhoneGap.exec(function(timeout){if(timeout<(frequency+10000)){PhoneGap.exec(null,null,"Accelerometer","setTimeout",[frequency+10000])}},function(e){},"Accelerometer","getTimeout",[]);var id=PhoneGap.createUUID();navigator.accelerometer.timers[id]=setInterval(function(){PhoneGap.exec(successCallback,errorCallback,"Accelerometer","getAcceleration",[])},(frequency?frequency:1));return id};Accelerometer.prototype.clearWatch=function(id){if(id&&navigator.accelerometer.timers[id]!=undefined){clearInterval(navigator.accelerometer.timers[id]);delete navigator.accelerometer.timers[id]}};PhoneGap.addConstructor(function(){if(typeof navigator.accelerometer=="undefined"){navigator.accelerometer=new Accelerometer()}});Camera=function(){this.successCallback=null;this.errorCallback=null;this.options=null};Camera.DestinationType={DATA_URL:0,FILE_URI:1};Camera.prototype.DestinationType=Camera.DestinationType;Camera.PictureSourceType={PHOTOLIBRARY:0,CAMERA:1,SAVEDPHOTOALBUM:2};Camera.prototype.PictureSourceType=Camera.PictureSourceType;Camera.prototype.getPicture=function(successCallback,errorCallback,options){if(typeof successCallback!="function"){console.log("Camera Error: successCallback is not a function");return}if(errorCallback&&(typeof errorCallback!="function")){console.log("Camera Error: errorCallback is not a function");return}this.successCallback=successCallback;this.errorCallback=errorCallback;this.options=options;var quality=80;if(options.quality){quality=this.options.quality}var destinationType=Camera.DestinationType.DATA_URL;if(this.options.destinationType){destinationType=this.options.destinationType}var sourceType=Camera.PictureSourceType.CAMERA;if(typeof this.options.sourceType=="number"){sourceType=this.options.sourceType}PhoneGap.exec(successCallback,errorCallback,"Camera","takePicture",[quality,destinationType,sourceType])};PhoneGap.addConstructor(function(){if(typeof navigator.camera=="undefined"){navigator.camera=new Camera()}});phonegap.Logger.enable();if(typeof console=="undefined"){console={}}console.log=function(msg){phonegap.Logger.log(msg)};var Contact=function(id,displayName,name,nickname,phoneNumbers,emails,addresses,ims,organizations,revision,birthday,gender,note,photos,categories,urls,timezone){this.id=id||null;this.displayName=displayName||null;this.name=name||null;this.nickname=nickname||null;this.phoneNumbers=phoneNumbers||null;this.emails=emails||null;this.addresses=addresses||null;this.ims=ims||null;this.organizations=organizations||null;this.revision=revision||null;this.birthday=birthday||null;this.gender=gender||null;this.note=note||null;this.photos=photos||null;this.categories=categories||null;this.urls=urls||null;this.timezone=timezone};var ContactName=function(formatted,familyName,givenName,middle,prefix,suffix){this.formatted=formatted||null;this.familyName=familyName||null;this.givenName=givenName||null;this.middleName=middle||null;this.honorificPrefix=prefix||null;this.honorificSuffix=suffix||null};var ContactField=function(type,value,pref){this.type=type||null;this.value=value||null;this.pref=pref||false};var ContactAddress=function(formatted,streetAddress,locality,region,postalCode,country){this.formatted=formatted||null;this.streetAddress=streetAddress||null;this.locality=locality||null;this.region=region||null;this.postalCode=postalCode||null;this.country=country||null};var ContactOrganization=function(name,dept,title){this.name=name||null;this.department=dept||null;this.title=title||null};var Contacts=function(){this.inProgress=false;this.records=[]};var ContactError=function(code){this.code=code};ContactError.UNKNOWN_ERROR=0;ContactError.INVALID_ARGUMENT_ERROR=1;ContactError.NOT_FOUND_ERROR=2;ContactError.TIMEOUT_ERROR=3;ContactError.PENDING_OPERATION_ERROR=4;ContactError.IO_ERROR=5;ContactError.NOT_SUPPORTED_ERROR=6;ContactError.PERMISSION_DENIED_ERROR=20;Contacts.prototype.create=function(properties){var contact=new Contact();for(var i in properties){if(contact[i]!=="undefined"){contact[i]=properties[i]}}return contact};Contact.prototype.save=function(success,fail){try{this.id=BlackBerryContacts.saveToDevice(this);if(success){success(this)}}catch(e){console.log("Error saving contact: "+e);if(fail){fail(new ContactError(ContactError.UNKNOWN_ERROR))}}};Contact.prototype.remove=function(success,fail){try{var bbContact=null;if(this.id){bbContact=BlackBerryContacts.findByUniqueId(this.id)}if(bbContact){console.log("removing contact: "+bbContact.uid);bbContact.remove();if(success){success(this)}}else{if(fail){fail(new ContactError(ContactError.NOT_FOUND_ERROR))}}}catch(e){console.log("Error removing contact "+this.id+": "+e);if(fail){fail(new ContactError(ContactError.UNKNOWN_ERROR))}}};Contact.prototype.clone=function(){var clonedContact=PhoneGap.clone(this);clonedContact.id=null;return clonedContact};Contacts.prototype.find=function(fields,success,fail,options){var numContacts=-1;var filter=null;if(options){if(options.multiple===false){numContacts=1}filter=options.filter}var filterExpression=BlackBerryContacts.buildFilterExpression(fields,filter);var bbContacts=blackberry.pim.Contact.find(filterExpression,null,numContacts);var contacts=[];for(var i in bbContacts){if(bbContacts[i]){contacts.push(BlackBerryContacts.createContact(bbContacts[i],fields))}}if(success&&success instanceof Function){success(contacts)}else{console.log("Error invoking Contacts.find success callback.")}};var ContactFindOptions=function(filter,multiple,updatedSince){this.filter=filter||"";this.multiple=multiple||true;this.updatedSince=updatedSince||""};PhoneGap.addConstructor(function(){if(typeof navigator.service==="undefined"){navigator.service=new Object()}if(typeof navigator.service.contacts==="undefined"){navigator.service.contacts=new Contacts()}});var BlackBerryContacts=function(){this.fieldMappings={id:"uid",displayName:"user1",name:["title","firstName","lastName"],"name.formatted":["title","firstName","lastName"],"name.givenName":"firstName","name.familyName":"lastName","name.honorificPrefix":"title",phoneNumbers:["faxPhone","homePhone","homePhone2","mobilePhone","pagerPhone","otherPhone","workPhone","workPhone2"],"phoneNumbers.value":["faxPhone","homePhone","homePhone2","mobilePhone","pagerPhone","otherPhone","workPhone","workPhone2"],emails:["email1","email2","email3"],addresses:["homeAddress.address1","homeAddress.address2","homeAddress.city","homeAddress.stateProvince","homeAddress.zipPostal","homeAddress.country","workAddress.address1","workAddress.address2","workAddress.city","workAddress.stateProvince","workAddress.zipPostal","workAddress.country"],"addresses.formatted":["homeAddress.address1","homeAddress.address2","homeAddress.city","homeAddress.stateProvince","homeAddress.zipPostal","homeAddress.country","workAddress.address1","workAddress.address2","workAddress.city","workAddress.stateProvince","workAddress.zipPostal","workAddress.country"],"addresses.streetAddress":["homeAddress.address1","homeAddress.address2","workAddress.address1","workAddress.address2"],"addresses.locality":["homeAddress.city","workAddress.city"],"addresses.region":["homeAddress.stateProvince","workAddress.stateProvince"],"addresses.country":["homeAddress.country","workAddress.country"],organizations:["company","jobTitle"],"organizations.name":"company","organizations.title":"jobTitle",birthday:"birthday",note:"note",categories:"categories",urls:"webpage","urls.value":"webpage"}};BlackBerryContacts.findByUniqueId=function(uid){if(!uid){return null}var bbContacts=blackberry.pim.Contact.find(new blackberry.find.FilterExpression("uid","==",uid));return bbContacts[0]||null};BlackBerryContacts.saveToDevice=function(contact){if(!contact){return}var bbContact=null;var update=false;if(contact.id){bbContact=BlackBerryContacts.findByUniqueId(contact.id)}if(!bbContact){bbContact=new blackberry.pim.Contact()}else{update=true}if(contact.name!==null){if(contact.name.givenName!==null){bbContact.firstName=contact.name.givenName}if(contact.name.familyName!==null){bbContact.lastName=contact.name.familyName}if(contact.name.honorificPrefix!==null){bbContact.title=contact.name.honorificPrefix}}if(contact.displayName!==null){bbContact.user1=contact.displayName}if(contact.note!==null){bbContact.note=contact.note}if(contact.birthday!==null){if(contact.birthday instanceof Date){bbContact.birthday=contact.birthday}else{var bday=contact.birthday.toString();bbContact.birthday=(bday.length>0)?new Date(bday):""}}if(contact.emails&&contact.emails instanceof Array){if(update){bbContact.email1="";bbContact.email2="";bbContact.email3=""}var email=null;for(var i=0;i<contact.emails.length;i+=1){email=contact.emails[i];if(!email||!email.value){continue}if(bbContact.email1===""){bbContact.email1=email.value}else{if(bbContact.email2===""){bbContact.email2=email.value}else{if(bbContact.email3===""){bbContact.email3=email.value}}}}}if(contact.phoneNumbers&&contact.phoneNumbers instanceof Array){if(update){bbContact.homePhone="";bbContact.homePhone2="";bbContact.workPhone="";bbContact.workPhone2="";bbContact.mobilePhone="";bbContact.faxPhone="";bbContact.pagerPhone="";bbContact.otherPhone=""}var type=null;var number=null;for(var i=0;i<contact.phoneNumbers.length;i+=1){if(!contact.phoneNumbers[i]||!contact.phoneNumbers[i].value){continue}type=contact.phoneNumbers[i].type;number=contact.phoneNumbers[i].value;if(type==="home"){if(bbContact.homePhone===""){bbContact.homePhone=number}else{if(bbContact.homePhone2===""){bbContact.homePhone2=number}}}else{if(type==="work"){if(bbContact.workPhone===""){bbContact.workPhone=number}else{if(bbContact.workPhone2===""){bbContact.workPhone2=number}}}else{if(type==="mobile"&&bbContact.mobilePhone===""){bbContact.mobilePhone=number}else{if(type==="fax"&&bbContact.faxPhone===""){bbContact.faxPhone=number}else{if(type==="pager"&&bbContact.pagerPhone===""){bbContact.pagerPhone=number}else{if(bbContact.otherPhone===""){bbContact.otherPhone=number}}}}}}}}if(contact.addresses&&contact.addresses instanceof Array){if(update){bbContact.homeAddress=null;bbContact.workAddress=null}var address=null;var bbHomeAddress=null;var bbWorkAddress=null;for(var i=0;i<contact.addresses.length;i+=1){address=contact.addresses[i];if(!address||address instanceof ContactAddress===false){continue}if(bbHomeAddress===null){bbHomeAddress=address.toBlackBerryAddress();bbContact.homeAddress=bbHomeAddress}else{if(bbWorkAddress===null){bbWorkAddress=address.toBlackBerryAddress();bbContact.workAddress=bbWorkAddress}}}}if(contact.urls&&contact.urls instanceof Array){if(update){bbContact.webpage=""}var url=null;for(var i=0;i<contact.urls.length;i+=1){url=contact.urls[i];if(!url||!url.value){continue}if(bbContact.webpage===""){bbContact.webpage=url.value;break}}}if(contact.organizations&&contact.organizations instanceof Array){if(update){bbContact.company=""}var org=null;for(var i=0;i<contact.organizations.length;i+=1){org=contact.organizations[i];if(!org){continue}if(bbContact.company===""){bbContact.company=org.name||"";bbContact.jobTitle=org.title||"";break}}}if(contact.categories&&contact.categories instanceof Array){bbContact.categories=[];var category=null;for(var i=0;i<contact.categories.length;i+=1){category=contact.categories[i];if(typeof category=="string"){bbContact.categories.push(category)}}}bbContact.save();if(contact.photos&&contact.photos instanceof Array){var photo=null;for(var i=0;i<contact.photos.length;i+=1){photo=contact.photos[i];if(!photo||!photo.value){continue}PhoneGap.exec(function(){},function(e){console.log("Contact.setPicture failed:"+e)},"Contact","setPicture",[bbContact.uid,photo.type,photo.value]);break}}return bbContact.uid};BlackBerryContacts.buildFilterExpression=function(fields,filter){if(!filter||filter===""){return null}var ciFilter="";for(var i=0;i<filter.length;i++){ciFilter=ciFilter+"["+filter[i].toLowerCase()+filter[i].toUpperCase()+"]"}filter=".*"+ciFilter+".*";var filterExpression=null;if(fields&&fields instanceof Array){var fe=null;for(var i in fields){if(!fields[i]){continue}var bbFields=navigator.service.BlackBerryContacts.fieldMappings[fields[i]];if(!bbFields){continue}for(var j in bbFields){fe=new blackberry.find.FilterExpression(bbFields[j],"REGEX",filter);if(filterExpression===null){filterExpression=fe}else{filterExpression=new blackberry.find.FilterExpression(filterExpression,"OR",fe)}}}}return filterExpression};ContactAddress.prototype.toBlackBerryAddress=function(){var bbAddress=new blackberry.pim.Address();bbAddress.address1=this.streetAddress||"";bbAddress.city=this.locality||"";bbAddress.stateProvince=this.region||"";bbAddress.zipPostal=this.postalCode||"";bbAddress.country=this.country||"";return bbAddress};ContactAddress.fromBlackBerryAddress=function(bbAddress){if(!bbAddress||bbAddress instanceof blackberry.pim.Address===false){return null}var address1=bbAddress.address1||"";var address2=bbAddress.address2||"";var streetAddress=address1+", "+address2;var locality=bbAddress.city||"";var region=bbAddress.stateProvince||"";var postalCode=bbAddress.zipPostal||"";var country=bbAddress.country||"";var formatted=streetAddress+", "+locality+", "+region+", "+postalCode+", "+country;return new ContactAddress(formatted,streetAddress,locality,region,postalCode,country)};BlackBerryContacts.createContact=function(bbContact,fields){if(!bbContact){return null}var contact=new Contact(bbContact.uid,bbContact.user1);if(!fields){return contact}for(var i in fields){var field=fields[i];if(!field){continue}if(field.indexOf("name")===0){var formattedName=bbContact.title+" "+bbContact.firstName+" "+bbContact.lastName;contact.name=new ContactName(formattedName,bbContact.lastName,bbContact.firstName,null,bbContact.title,null)}else{if(field.indexOf("phoneNumbers")===0){var phoneNumbers=[];if(bbContact.homePhone){phoneNumbers.push(new ContactField("home",bbContact.homePhone))}if(bbContact.homePhone2){phoneNumbers.push(new ContactField("home",bbContact.homePhone2))}if(bbContact.workPhone){phoneNumbers.push(new ContactField("work",bbContact.workPhone))}if(bbContact.workPhone2){phoneNumbers.push(new ContactField("work",bbContact.workPhone2))}if(bbContact.mobilePhone){phoneNumbers.push(new ContactField("mobile",bbContact.mobilePhone))}if(bbContact.faxPhone){phoneNumbers.push(new ContactField("fax",bbContact.faxPhone))}if(bbContact.pagerPhone){phoneNumbers.push(new ContactField("pager",bbContact.pagerPhone))}if(bbContact.otherPhone){phoneNumbers.push(new ContactField("other",bbContact.otherPhone))}contact.phoneNumbers=phoneNumbers}else{if(field.indexOf("emails")===0){var emails=[];if(bbContact.email1){emails.push(new ContactField(null,bbContact.email1,null))}if(bbContact.email2){emails.push(new ContactField(null,bbContact.email2,null))}if(bbContact.email3){emails.push(new ContactField(null,bbContact.email3,null))}contact.emails=emails}else{if(field.indexOf("addresses")===0){var addresses=[];if(bbContact.homeAddress){addresses.push(ContactAddress.fromBlackBerryAddress(bbContact.homeAddress))}if(bbContact.workAddress){addresses.push(ContactAddress.fromBlackBerryAddress(bbContact.workAddress))}contact.addresses=addresses}else{if(field.indexOf("birthday")===0){contact.birthday=bbContact.birthday}else{if(field.indexOf("note")===0){contact.note=bbContact.note}else{if(field.indexOf("organizations")===0){var organizations=[];if(bbContact.company||bbContact.jobTitle){organizations.push(new ContactOrganization(bbContact.company,null,bbContact.jobTitle))}contact.organizations=organizations}else{if(field.indexOf("categories")===0){contact.categories=bbContact.categories}else{if(field.indexOf("urls")===0){var urls=[];if(bbContact.webpage){urls.push(new ContactField(null,bbContact.webpage))}contact.urls=urls}else{if(field.indexOf("photos")===0){var photos=[];if(bbContact.picture){photos.push(new ContactField("base64",bbContact.picture))}contact.photos=photos}}}}}}}}}}}return contact};PhoneGap.addConstructor(function(){if(typeof navigator.service==="undefined"){navigator.service=new Object()}if(typeof navigator.service.BlackBerryContacts==="undefined"){navigator.service.BlackBerryContacts=new BlackBerryContacts()}});function Device(){this.platform=phonegap.device.platform;this.version=blackberry.system.softwareVersion;this.name=blackberry.system.model;this.uuid=phonegap.device.uuid;this.phonegap=phonegap.device.phonegap}PhoneGap.addConstructor(function(){navigator.device=window.device=new Device();PhoneGap.onPhoneGapInfoReady.fire()});function FileProperties(filePath){this.filePath=filePath;this.size=0;this.lastModifiedDate=null}function FileError(){this.code=null}FileError.NOT_FOUND_ERR=1;FileError.SECURITY_ERR=2;FileError.ABORT_ERR=3;FileError.NOT_READABLE_ERR=4;FileError.ENCODING_ERR=5;FileError.NO_MODIFICATION_ALLOWED_ERR=6;FileError.INVALID_STATE_ERR=7;FileError.SYNTAX_ERR=8;FileError.INVALID_MODIFICATION_ERR=9;FileError.QUOTA_EXCEEDED_ERR=10;FileError.TYPE_MISMATCH_ERR=11;FileError.PATH_EXISTS_ERR=12;function FileMgr(){}FileMgr.prototype.getRootPaths=function(){return blackberry.io.dir.getRootDirs()};FileMgr.prototype.getFreeDiskSpace=function(filePath){return blackberry.io.dir.getFreeSpaceForRoot(filePath)};FileMgr.prototype.readAsText=function(fileName,encoding,successCallback,errorCallback){PhoneGap.exec(successCallback,errorCallback,"File","readAsText",[fileName,encoding])};FileMgr.prototype.readAsDataURL=function(fileName,successCallback,errorCallback){PhoneGap.exec(successCallback,errorCallback,"File","readAsDataURL",[fileName])};FileMgr.prototype.write=function(fileName,data,position,successCallback,errorCallback){PhoneGap.exec(successCallback,errorCallback,"File","write",[fileName,data,position])};FileMgr.prototype.testFileExists=function(fullPath){return blackberry.io.file.exists(fullPath)};FileMgr.prototype.testDirectoryExists=function(fullPath){return blackberry.io.dir.exists(fullPath)};FileMgr.prototype.getFileProperties=function(fileName){var fileProperties=new FileProperties(fileName);if(blackberry.io.file.exists(fileName)){var props=blackberry.io.file.getFileProperties(fileName);fileProperties.size=props.size;fileProperties.lastModifiedDate=props.dateModified}else{if(blackberry.io.dir.exists(fileName)){throw FileError.TYPE_MISMATCH_ERR}}return fileProperties};FileMgr.prototype.truncate=function(fileName,size,successCallback,errorCallback){PhoneGap.exec(successCallback,errorCallback,"File","truncate",[fileName,size])};FileMgr.prototype.deleteFile=function(fileName){if(blackberry.io.file.exists(fileName)){blackberry.io.file.deleteFile(fileName)}else{if(blackberry.io.dir.exists(fileName)){throw FileError.TYPE_MISMATCH_ERR}else{throw FileError.NOT_FOUND_ERR}}};FileMgr.prototype.createDirectory=function(dirName){if(!blackberry.io.dir.exists(dirName)){if(dirName.substr(-1)!=="/"){dirName+="/"}blackberry.io.dir.createNewDir(dirName)}else{throw FileError.PATH_EXISTS_ERR}};FileMgr.prototype.deleteDirectory=function(dirName){blackberry.io.dir.deleteDirectory(dirName)};PhoneGap.addConstructor(function(){if(typeof navigator.fileMgr=="undefined"){navigator.fileMgr=new FileMgr()}});function FileReader(){this.fileName="";this.readyState=0;this.result=null;this.error=null;this.onloadstart=null;this.onprogress=null;this.onload=null;this.onerror=null;this.onloadend=null;this.onabort=null}FileReader.EMPTY=0;FileReader.LOADING=1;FileReader.DONE=2;FileReader.prototype.abort=function(){var event;this.readyState=FileReader.DONE;this.result=null;var error=new FileError();error.code=error.ABORT_ERR;this.error=error;if(typeof this.onerror=="function"){event={type:"error",target:this};this.onerror(event)}if(typeof this.onabort=="function"){event={type:"abort",target:this};this.onabort(event)}if(typeof this.onloadend=="function"){event={type:"loadend",target:this};this.onloadend(event)}};FileReader.prototype.readAsText=function(file,encoding){var event;var enc=encoding?encoding:"UTF-8";this.readyState=FileReader.LOADING;if(typeof this.onloadstart=="function"){event={type:"loadstart",target:this};this.onloadstart(event)}this.fileName=file;var me=this;navigator.fileMgr.readAsText(file,enc,function(result){if(me.readyState===FileReader.DONE){return}me.result=result;if(typeof me.onload=="function"){event={type:"load",target:me};me.onload(event)}me.readyState=FileReader.DONE;if(typeof me.onloadend=="function"){event={type:"loadend",target:me};me.onloadend(event)}},function(error){if(me.readyState===FileReader.DONE){return}var err=new FileError();err.code=error;me.error=err;me.result=null;if(typeof me.onerror=="function"){event={type:"error",target:me};me.onerror(event)}me.readyState=FileReader.DONE;if(typeof me.onloadend=="function"){event={type:"loadend",target:me};me.onloadend(event)}})};FileReader.prototype.readAsDataURL=function(file){var event;this.readyState=FileReader.LOADING;if(typeof this.onloadstart=="function"){event={type:"loadstart",target:this};this.onloadstart(event)}this.fileName=file;var me=this;navigator.fileMgr.readAsDataURL(file,function(result){if(me.readyState===FileReader.DONE){return}me.result=result;if(typeof me.onload=="function"){event={type:"load",target:me};me.onload(event)}me.readyState=FileReader.DONE;if(typeof me.onloadend=="function"){event={type:"loadend",target:me};me.onloadend(event)}},function(error){if(me.readyState===FileReader.DONE){return}var err=new FileError();err.code=error;me.error=err;me.result=null;if(typeof me.onerror=="function"){event={type:"error",target:me};me.onerror(event)}me.readyState=FileReader.DONE;if(typeof me.onloadend=="function"){event={type:"loadend",target:me};me.onloadend(event)}})};function FileWriter(filePath,append){this.fileName=filePath;this.length=0;var fp=navigator.fileMgr.getFileProperties(filePath);this.length=fp.size;this.position=(append!==true)?0:this.length;this.readyState=0;this.error=null;this.onwritestart=null;this.onprogress=null;this.onwrite=null;this.onwriteend=null;this.onabort=null;this.onerror=null}FileWriter.INIT=0;FileWriter.WRITING=1;FileWriter.DONE=2;FileWriter.prototype.abort=function(){var event;if(this.readyState===FileWriter.DONE||this.readyState===FileWriter.INIT){throw FileError.INVALID_STATE_ERR}var error=new FileError();error.code=error.ABORT_ERR;this.error=error;if(typeof this.onerror=="function"){event={type:"error",target:this};this.onerror(event)}if(typeof this.onabort=="function"){event={type:"abort",target:this};this.onabort(event)}this.readyState=FileWriter.DONE;if(typeof this.writeend=="function"){event={type:"writeend",target:this};this.writeend(event)}};FileWriter.prototype.seek=function(offset){if(this.readyState===FileWriter.WRITING){throw FileError.INVALID_STATE_ERR}if(!offset){return}if(offset>this.length){this.position=this.length}else{if(offset<0){this.position=Math.max(offset+this.length,0)}else{this.position=offset}}};FileWriter.prototype.truncate=function(size){var event;if(this.readyState===FileWriter.WRITING){throw FileError.INVALID_STATE_ERR}this.readyState=FileWriter.WRITING;if(typeof this.onwritestart=="function"){event={type:"writestart",target:this};this.onwritestart(event)}var me=this;navigator.fileMgr.truncate(this.fileName,size,function(result){if(me.readyState===FileWriter.DONE){return}me.length=result;me.position=Math.min(me.position,result);if(typeof me.onwrite=="function"){event={type:"write",target:me};me.onwrite(event)}me.readyState=FileWriter.DONE;if(typeof me.onwriteend=="function"){event={type:"writeend",target:me};me.onwriteend(event)}},function(error){if(me.readyState===FileWriter.DONE){return}var err=new FileError();err.code=error;me.error=err;if(typeof me.onerror=="function"){event={type:"error",target:me};me.onerror(event)}me.readyState=FileWriter.DONE;if(typeof me.onwriteend=="function"){event={type:"writeend",target:me};me.onwriteend(event)}})};FileWriter.prototype.write=function(data){var event;if(this.readyState===FileWriter.WRITING){throw FileError.INVALID_STATE_ERR}this.readyState=FileWriter.WRITING;if(typeof this.onwritestart=="function"){event={type:"writestart",target:this};this.onwritestart(event)}var me=this;navigator.fileMgr.write(this.fileName,data,this.position,function(result){if(me.readyState===FileWriter.DONE){return}me.length=Math.max(me.length,me.position+result);me.position+=result;if(typeof me.onwrite=="function"){event={type:"write",target:me};me.onwrite(event)}me.readyState=FileWriter.DONE;if(typeof me.onwriteend=="function"){event={type:"writeend",target:me};me.onwriteend(event)}},function(error){if(me.readyState===FileWriter.DONE){return}var err=new FileError();err.code=error;me.error=err;if(typeof me.onerror=="function"){event={type:"error",target:me};me.onerror(event)}me.readyState=FileWriter.DONE;if(typeof me.onwriteend=="function"){event={type:"writeend",target:me};me.onwriteend(event)}})};function FileTransfer(){}function FileUploadResult(){this.bytesSent=0;this.responseCode=null;this.response=null}function FileTransferError(){this.code=null}FileTransferError.FILE_NOT_FOUND_ERR=1;FileTransferError.INVALID_URL_ERR=2;FileTransferError.CONNECTION_ERR=3;FileTransfer.prototype.upload=function(filePath,server,successCallback,errorCallback,options){var fileKey=null;var fileName=null;var mimeType=null;var params=null;if(options){fileKey=options.fileKey;fileName=options.fileName;mimeType=options.mimeType;params=options.params}var fail=function(error){var err=new FileTransferError();err.code=error;if(typeof errorCallback==="function"){errorCallback(err)}};PhoneGap.exec(successCallback,fail,"FileTransfer","upload",[filePath,server,fileKey,fileName,mimeType,params])};function FileUploadOptions(fileKey,fileName,mimeType,params){this.fileKey=fileKey||null;this.fileName=fileName||null;this.mimeType=mimeType||null;this.params=params||null}function Geolocation(){this.lastPosition=null;this.listeners={}}function PositionError(code,message){this.code=code;this.message=message}PositionError.PERMISSION_DENIED=1;PositionError.POSITION_UNAVAILABLE=2;PositionError.TIMEOUT=3;Geolocation.prototype.getCurrentPosition=function(successCallback,errorCallback,options){var id="global";if(navigator._geo.listeners[id]){console.log("Geolocation Error: Still waiting for previous getCurrentPosition() request.");try{errorCallback(new PositionError(PositionError.TIMEOUT,"Geolocation Error: Still waiting for previous getCurrentPosition() request."))}catch(e){}return}var maximumAge=0;var timeout=3600000;var enableHighAccuracy=false;if(options){if(options.maximumAge&&(options.maximumAge>0)){maximumAge=options.maximumAge}if(options.enableHighAccuracy){enableHighAccuracy=options.enableHighAccuracy}if(options.timeout){timeout=(options.timeout<0)?0:options.timeout}}navigator._geo.listeners[id]={success:successCallback,fail:errorCallback};PhoneGap.exec(null,errorCallback,"Geolocation","getCurrentPosition",[id,maximumAge,timeout,enableHighAccuracy])};Geolocation.prototype.watchPosition=function(successCallback,errorCallback,options){var maximumAge=0;var timeout=10000;var enableHighAccuracy=false;if(options){if(options.maximumAge&&(options.maximumAge>0)){maximumAge=options.maximumAge}if(options.enableHighAccuracy){enableHighAccuracy=options.enableHighAccuracy}if(options.timeout){timeout=(options.timeout<0)?0:options.timeout}}var id=PhoneGap.createUUID();navigator._geo.listeners[id]={success:successCallback,fail:errorCallback};PhoneGap.exec(null,errorCallback,"Geolocation","watchPosition",[id,maximumAge,timeout,enableHighAccuracy]);return id};Geolocation.prototype.success=function(id,result){var p=result.message;var coords=new Coordinates(p.latitude,p.longitude,p.altitude,p.accuracy,p.heading,p.speed,p.alt_accuracy);var loc=new Position(coords,p.timestamp);try{navigator._geo.lastPosition=loc;navigator._geo.listeners[id].success(loc)}catch(e){console.log("Geolocation Error: Error calling success callback function.")}if(id=="global"){delete navigator._geo.listeners.global}};Geolocation.prototype.fail=function(id,result){var code=result.status;var msg=result.message;try{navigator._geo.listeners[id].fail(new PositionError(code,msg))}catch(e){console.log("Geolocation Error: Error calling error callback function.")}if(id=="global"){delete navigator._geo.listeners.global}};Geolocation.prototype.clearWatch=function(id){PhoneGap.exec(null,null,"Geolocation","stop",[id]);delete navigator._geo.listeners[id]};Geolocation.usingPhoneGap=false;Geolocation.usePhoneGap=function(){if(Geolocation.usingPhoneGap){return}Geolocation.usingPhoneGap=true;navigator.geolocation.getCurrentPosition=navigator._geo.getCurrentPosition;navigator.geolocation.watchPosition=navigator._geo.watchPosition;navigator.geolocation.clearWatch=navigator._geo.clearWatch;navigator.geolocation.success=navigator._geo.success;navigator.geolocation.fail=navigator._geo.fail};PhoneGap.addConstructor(function(){navigator._geo=new Geolocation();if(typeof navigator.geolocation=="undefined"){navigator.geolocation=navigator._geo;Geolocation.usingPhoneGap=true}});NetworkStatus={NOT_REACHABLE:0,REACHABLE_VIA_CARRIER_DATA_NETWORK:1,REACHABLE_VIA_WIFI_NETWORK:2};function Network(){this.lastReachability=null}Network.prototype.isReachable=function(uri,callback,options){var isIpAddress=false;if(options&&options.isIpAddress){isIpAddress=options.isIpAddress}PhoneGap.exec(callback,null,"Network Status","isReachable",[uri,isIpAddress])};PhoneGap.addConstructor(function(){if(typeof navigator.network=="undefined"){navigator.network=new Network()}});function Notification(){}Notification.prototype.alert=function(message,completeCallback,title,buttonLabel){var _title=(title||"Alert");var _buttonLabel=(buttonLabel||"OK");PhoneGap.exec(completeCallback,null,"Notification","alert",[message,_title,_buttonLabel])};Notification.prototype.confirm=function(message,resultCallback,title,buttonLabels){var _title=(title||"Confirm");var _buttonLabels=(buttonLabels||"OK,Cancel");return PhoneGap.exec(resultCallback,null,"Notification","confirm",[message,_title,_buttonLabels])};Notification.prototype.vibrate=function(mills){PhoneGap.exec(null,null,"Notification","vibrate",[mills])};Notification.prototype.beep=function(count){PhoneGap.exec(null,null,"Notification","beep",[count])};PhoneGap.addConstructor(function(){if(typeof navigator.notification=="undefined"){navigator.notification=new Notification()}});function Position(coords,timestamp){this.coords=coords;this.timestamp=timestamp}function Coordinates(lat,lng,alt,acc,head,vel,altacc){this.latitude=lat;this.longitude=lng;this.accuracy=acc;this.altitude=alt;this.heading=head;this.speed=vel;this.altitudeAccuracy=(altacc!="undefined")?altacc:null};